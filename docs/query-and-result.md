# 查询对象与结果对象

本文档用于记录划词翻译里面用到的两种重要的对象。下面给出的代码示例仅用于说明两种对象的结构，并不存在于划词翻译的代码中。

## 查询对象

查询对象多用于内容脚本中发送给背景页，然后等待背景页返回结果对象。

```js
function QueryObj () {
    this.text = ''; // 必选，待查询的文本

    this.from = 'auto'; // 可选，用于提供给翻译引擎的源语言，默认为 auto，即由翻译引擎自行判断
    this.to = 'auto'; // 可选，期望收到的目标语种，注意，翻译引擎可能会忽略此项设置，例如有道不支持设置目标语种。默认使用用户设置的目标语种，是以谷歌翻译的语种列表为标准的
    this.apiId = ''; // 可选，指定翻译引擎。如果没有提供，则使用用户设置的默认翻译引擎。
}
```

有一点需要注意：QueryObj里面的语种是以 google 翻译的语种为标准的，但可能你的翻译引擎是另一种表示法，例如，标准的英语语种是 `en` ，但在有道翻译中是 `eng`。你可能需要一种转换语种的方法。

## 结果对象

结果对象比较特殊，因为查询结果的过程中可能出现错误。

```js
function ResultObj () {

    // 无论正常与否，以下属性都是必选的
    this.api = {}; // 这个属性是由划词翻译自动加上的，无需设置。翻译接口本身。
    this.query = ''; // 这个属性也是由划词翻译自动加上的，等于 QueryObj 中的 text 属性

    // 查询正常的情况下：
    this.result = ''; // 必选的字符串，可以包含html元素。翻译结果
    this.linkToResult = ''; // 必选。指向翻译引擎对应的在线翻译结果的网址
    this.response = {}; // 必选。翻译引擎返回的原始翻译数据

    this.from = ''; // 可选。翻译引擎返回的源语言的语种，注意不是查询对象里面的。
    this.to = ''; // 可选。翻译引擎返回的翻译结果的语种，注意不是查询对象里面的。
    this.detailed = ''; // 可选的字符串，可以包含html元素。返回详细的翻译信息，例如单词的详细释义
    this.phonetic = {}; // 可选。音标

    // 查询出错的情况下：
    this.error = ''; // 必选。描述错误的字符串。字符串应该明确阐述发生的错误类型，例如超时、网络错误、或者是服务器返回了错误的类型，或者是由服务器自身返回的错误
}
```

## 关于错误处理

任何错误都必须被明确的处理，以提高用户体验。错误分为下面四种类型：

### 超时
给你的 ajax 请求设置一个超时时间，避免用户长时间等待

### 网络错误
提示用户检查网络设置

### 服务器返回了错误的数据类型
这是一个特殊的错误，常见于`中间人`攻击，例如某城宽带会把远程服务器返回的 `json` 格式的数据转换为一段 html 字符串发送给浏览器。

### 服务器自身返回的错误
一般情况下翻译服务器会定义自身的错误，比如百度翻译会在服务器发生错误时返回一个错误代码 50001 或者 50002，表示服务器繁忙或者处理请求超时。你应该为每种错误提供一种便于用户理解的说法。
